name: Sync Live Theme Changes

on:
  # Run every 6 hours
  schedule:
    - cron: '0 */6 * * *'
  
  # Allow manual trigger
  workflow_dispatch:

jobs:
  sync:
    name: Sync Live Theme
    runs-on: ubuntu-latest
    
    steps:
      # Checkout repository
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      # Sync live theme changes
      - name: Sync from live theme
        id: sync
        uses: ShopLab-Team/shopify-theme-deployment-manager@v1
        with:
          mode: sync-live
          # Store can be provided as input or use SHOPIFY_STORE_URL secret
          store: ${{ vars.SHOPIFY_STORE }}  # Optional if using SHOPIFY_STORE_URL secret
          
          # Create PR instead of direct push (recommended)
          sync.output: pr
          
          # Optional: customize what to sync (defaults to JSON files)
          # sync.only_globs: |
          #   templates/*.json
          #   config/settings_data.json
          #   locales/*.json
        
        env:
          SHOPIFY_CLI_THEME_TOKEN: ${{ secrets.SHOPIFY_CLI_THEME_TOKEN }}
          # SHOPIFY_STORE_URL: ${{ secrets.SHOPIFY_STORE_URL }}  # Alternative to 'store' input
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      
      # Optional: Display sync results
      - name: Sync Summary
        if: always()
        run: |
          echo "### ðŸ“Š Sync Results"
          echo "- **Status**: ${{ steps.sync.outcome }}"
          echo "- **Changes**: ${{ steps.sync.outputs.changes || 'None' }}"
          echo "- **PR**: ${{ steps.sync.outputs.pull_request_url || 'N/A' }}"
